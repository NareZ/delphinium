<!DOCTYPE html>
<script type="text/javascript">
	var moduleData = {{ moduleData|raw}};
	var avTags = {{ avTags|raw}};
        var courseId = {{courseId}}
</script>

<div id="flashMsg" class="hidden"><span >This item can't be dragged to the top because it is unpublished</span></div>

<div ng-app="treeApp" ng-controller="treeCtrl">
    
{% verbatim %}
    <a href="" class="btn btn btn-primary" ng-click="reloadApp()">Refresh Data from Canvas</a>
    <i class="icon-spinner icon-spin icon-large" ng-show="loading"></i>
    <div class="buttons">
        <a href="" class="btn btn-default pull-right" ng-click="collapseAll()">Collapse all</a>
        <a href="" class="btn btn-default pull-right" ng-click="expandAll()">Expand all</a>
    </div>
    <div class="manager">
    
        <!-- Nested node template -->
        <script type="text/ng-template" id="nodes_renderer.html">
          <div ui-tree-handle class="tree-node tree-node-content" ng-class="{'unpublishedModule': (item.published==='0')}">
            <a class="btn btn-success btn-xs" ng-if="item.children && item.children.length > 0" nodrag ng-click="toggle(this)">
           
            <span ng-class="{'icon-chevron-right': collapsed, 'icon-chevron-down': !collapsed}"></span></a>
            {{item.name}}
          </div>
  
        <a ng-class="{'icon-chevron-right': isExpanded, 'icon-chevron-down': !isExpanded}"
            class="pull-right btn expand" nodrag ng-click="showContent(item)"></a>
            
        <ng-switch on="item.published">
          <span class="icon-cloud unpublishedModuleIcon pull-right btn" ng-switch-when="0"> unpublished</span>
        </ng-switch>
 
        <div id="div{{item.module_id}}" class="node hidden">
            <div class="divContent" ng-repeat="item in item.module_items" >
                <a href="" class="contentLink" ng-class="{'unpublishedItem': (item.published==='0')}">
                    <i class="icon-tasks contentType"></i>
                    <span>{{item.title}}</span>
                </a>
                <a title="Click to edit tags" class="btn icon-tags dive" ng-class="{'unpublishedItem': (item.published==='0')}"
                    nodrag ng-click="showTagsFunc(this)"></a>  
                    
                <ng-switch on="item.published">
                    <span class="btn icon-cloud unpublishedTagIcon" ng-switch-when="0"> unpublished</span>
                </ng-switch>
                <div id="div{{item.module_item_id}}" class="hidden tagNode">
                    <div class="divTags" width='350px' height='auto'>
                        <form ng-submit="addTags(this)">
                            Current tags:
                            <ul>
                                <li ng-repeat="tag in tags">{{tag}}
                                    <i class="removeTags" ng-click="deleteTag(this, tag)">X</i>
                                </li>
                            </ul>
                            
                            
                            Possible tags:
                            <ul>
                                <li class="addInnerTag"  ng-repeat="item in possibleTags"><i ng-click="addInnerTag(this, item)">{{item}}</i>
                                </li>
                            </ul> 
                    
                            Add your own tags separated by a comma.<br/>
                            <input type="text" ng-model="tagValue">
                            <input type="submit" value="Add Tags">
                        </form>
                        
                        
                            
                    </div>
                </div>
            </div>
        </div>

          <ol ui-tree-nodes="" ng-model="item.children" ng-class="{hidden: collapsed}">
            <li ng-repeat="item in item.children" ui-tree-node ng-include="'nodes_renderer.html'">
            </li>
          </ol>
        </script>
        <div ui-tree callbacks="treeOptions" id="tree-root">
          <ol ui-tree-nodes="" ng-model="data">
            <li class="treeItem" ng-repeat="item in data" ui-tree-node ng-include="'nodes_renderer.html'"></li>
          </ol>
        </div>
        
    </div>

  {% endverbatim %}  
</div>

  